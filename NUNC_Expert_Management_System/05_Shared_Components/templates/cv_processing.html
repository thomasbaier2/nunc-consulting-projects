
<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CV-Verarbeitung - NUNC Expert Management System</title>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Open Sans', sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #ffffff;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            text-align: center;
            color: #ffffff;
            margin-bottom: 40px;
            border-bottom: 3px solid #0f3460;
            padding-bottom: 20px;
        }
        .header h1 {
            font-size: 2.5em;
            margin: 0;
            background: linear-gradient(45deg, #0f3460, #1a1a2e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 700;
        }
        .upload-section {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            color: #1a1a2e;
        }
        .upload-area {
            border: 3px dashed #0f3460;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            margin: 20px 0;
            transition: all 0.3s ease;
        }
        .upload-area:hover {
            background: rgba(15, 52, 96, 0.1);
        }
        .upload-area.dragover {
            background: rgba(15, 52, 96, 0.2);
            border-color: #1a1a2e;
        }
        .file-input {
            display: none;
        }
        .upload-btn {
            background: linear-gradient(135deg, #0f3460, #1a1a2e);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .upload-btn:hover {
            background: linear-gradient(135deg, #1a1a2e, #0f3460);
            transform: translateY(-2px);
        }
        .process-btn {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            margin: 20px 0;
            transition: all 0.3s ease;
        }
        .process-btn:hover {
            background: linear-gradient(135deg, #20c997, #28a745);
            transform: translateY(-2px);
        }
        .results-section {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            color: #1a1a2e;
            display: none;
        }
        .profile-data {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        .profile-field {
            margin: 10px 0;
        }
        .profile-field strong {
            color: #0f3460;
        }
        .download-btn {
            background: linear-gradient(135deg, #17a2b8, #138496);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            margin: 10px 5px;
            transition: all 0.3s ease;
        }
        .download-btn:hover {
            background: linear-gradient(135deg, #138496, #17a2b8);
            transform: translateY(-2px);
        }
        .back-btn {
            background: linear-gradient(135deg, #6c757d, #495057);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            margin: 20px 0;
            transition: all 0.3s ease;
        }
        .back-btn:hover {
            background: linear-gradient(135deg, #495057, #6c757d);
            transform: translateY(-2px);
        }
        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #0f3460;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìÑ CV-Verarbeitung</h1>
            <p>Laden Sie PDF-CVs hoch und konvertieren Sie sie automatisch in NUNC-Profile</p>
        </div>
        
        <div class="upload-section">
            <h2>PDF-CV hochladen</h2>
            <div class="upload-area" id="uploadArea">
                <p>üìÅ Ziehen Sie eine PDF-Datei hierher oder klicken Sie zum Ausw√§hlen</p>
                <input type="file" id="fileInput" class="file-input" accept=".pdf">
                <button class="upload-btn" onclick="document.getElementById('fileInput').click()">
                    Datei ausw√§hlen
                </button>
            </div>
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>CV wird verarbeitet...</p>
            </div>
        </div>
        
        <div class="results-section" id="resultsSection">
            <h2>Verarbeitetes Profil</h2>
            <div id="profileData"></div>
            <div>
                <button class="download-btn" id="downloadWordBtn" onclick="downloadWord()">
                    üìÑ Word-Dokument herunterladen
                </button>
                <button class="download-btn" id="saveProfileBtn" onclick="saveProfile()">
                    üíæ Profil speichern
                </button>
            </div>
        </div>
        
        <div style="text-align: center;">
            <button class="back-btn" onclick="window.location.href='/'">
                ‚Üê Zur√ºck zur Hauptseite
            </button>
        </div>
    </div>
    
    <script>
        let currentProfileData = null;
        
        // Drag & Drop Funktionalit√§t
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });
        
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        });
        
        function handleFile(file) {
            if (file.type !== 'application/pdf') {
                alert('Bitte w√§hlen Sie eine PDF-Datei aus.');
                return;
            }
            
            const formData = new FormData();
            formData.append('file', file);
            
            // Loading anzeigen
            document.getElementById('loading').style.display = 'block';
            document.getElementById('resultsSection').style.display = 'none';
            
            fetch('/api/cv/upload', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('loading').style.display = 'none';
                
                if (data.success) {
                    currentProfileData = data.processed_data;
                    displayProfile(data.processed_data);
                } else {
                    alert('Fehler: ' + data.error);
                }
            })
            .catch(error => {
                document.getElementById('loading').style.display = 'none';
                alert('Fehler beim Hochladen: ' + error);
            });
        }
        
        function displayProfile(profileData) {
            const profileHtml = `
                <div class="profile-data">
                    <div class="profile-field"><strong>Name:</strong> ${profileData.expert_name || 'Nicht verf√ºgbar'}</div>
                    <div class="profile-field"><strong>Hauptfokus:</strong> ${profileData.hauptfokus || 'Nicht verf√ºgbar'}</div>
                    <div class="profile-field"><strong>Sprachen:</strong> ${profileData.sprachen || 'Nicht verf√ºgbar'}</div>
                    <div class="profile-field"><strong>Zur Person:</strong> ${profileData.zur_person || 'Nicht verf√ºgbar'}</div>
                    <div class="profile-field"><strong>Technologien:</strong> ${profileData.technologien || 'Nicht verf√ºgbar'}</div>
                    <div class="profile-field"><strong>Besondere Kenntnisse:</strong> ${profileData.besondere_kenntnisse || 'Nicht verf√ºgbar'}</div>
                    <div class="profile-field"><strong>Branchenkenntnisse:</strong> ${profileData.branchenkenntnisse || 'Nicht verf√ºgbar'}</div>
                    <div class="profile-field"><strong>Methoden:</strong> ${profileData.methoden || 'Nicht verf√ºgbar'}</div>
                    <div class="profile-field"><strong>Zertifizierungen:</strong> ${profileData.zertifizierungen || 'Nicht verf√ºgbar'}</div>
                    <div class="profile-field"><strong>Projekthistorie:</strong> ${profileData.projekthistorie_text || 'Nicht verf√ºgbar'}</div>
                </div>
            `;
            
            document.getElementById('profileData').innerHTML = profileHtml;
            document.getElementById('resultsSection').style.display = 'block';
        }
        
        function downloadWord() {
            if (!currentProfileData) {
                alert('Kein Profil verf√ºgbar');
                return;
            }
            
            fetch('/api/cv/generate-word', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(currentProfileData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    window.open(data.download_url, '_blank');
                } else {
                    alert('Fehler beim Generieren des Word-Dokuments: ' + data.error);
                }
            })
            .catch(error => {
                alert('Fehler: ' + error);
            });
        }
        
        function saveProfile() {
            if (!currentProfileData) {
                alert('Kein Profil verf√ºgbar');
                return;
            }
            
            fetch('/api/profiles', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(currentProfileData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Profil erfolgreich gespeichert!');
                } else {
                    alert('Fehler beim Speichern: ' + data.error);
                }
            })
            .catch(error => {
                alert('Fehler: ' + error);
            });
        }
    </script>
</body>
</html>
    